---
title: C API 函数列表
sidebar_position: 2
---

# C API 函数列表

## 1. 初始化与消息循环

### JadeView_init

```c
int JadeView_init(int enable_devtools, const char* log_path, const char* data_directory);
```

**功能**：初始化 JadeView DLL，启动 GUI 线程。

**参数**：
- `enable_devtools`：是否启用开发者工具（0=禁用，1=启用）
- `log_path`：日志文件路径，NULL 表示不输出日志到文件
- `data_directory`：WebView 数据目录，NULL 表示使用默认值

**返回值**：
- 1：初始化成功
- 0：初始化失败

**说明**：
- 此函数会启动一个新的 GUI 线程，所有窗口操作都在该线程中执行
- 初始化完成后会发送 "app-ready" 事件

### run_message_loop

```c
int run_message_loop();
```

**功能**：运行消息循环，阻塞等待应用程序退出。

**返回值**：
- 1：消息循环正常退出

**说明**：
- 在 DLL 模式下，此函数通常不需要宿主调用，因为已在 `JadeView_init` 中创建了 GUI 线程
- 此函数用于阻塞等待，直到 `cleanup_all_windows` 被调用

## 2. 窗口创建与管理

### create_webview_window

```c
unsigned int create_webview_window(
    const char* url,
    unsigned int parent_window_id,
    const WebViewWindowOptions* options,
    const WebViewSettings* webview_settings
);
```

**功能**：创建一个新的 WebView 窗口。

**参数**：
- `url`：窗口初始加载的 URL
- `parent_window_id`：父窗口 ID，0 表示无父窗口
- `options`：[WebViewWindowOptions](/guides/reference/data-structures#webview-窗口选项结构体) 指针，NULL 表示使用默认选项
- `webview_settings`：[WebViewSettings](/guides/reference/data-structures#webview-设置结构体) 指针，NULL 表示使用默认设置

**返回值**：
- 非零值：请求的窗口 ID
- 0：创建失败

**说明**：
- 窗口实际创建是在事件循环线程中异步完成的
- 函数立即返回请求的窗口 ID
- **重要**：窗口必须在 `app-ready` 事件触发后才能创建，否则会导致创建失败

### close_window

```c
int close_window(uint32_t window_id);
```

**功能**：关闭指定 ID 的窗口，释放窗口资源。

**参数**：
- `window_id`：要关闭的窗口 ID

**返回值**：
- 1：成功
- 0：失败

### request_redraw

```c
int request_redraw(uint32_t window_id);
```

**功能**：请求指定窗口重绘，刷新窗口内容。

**参数**：
- `window_id`：要重绘的窗口 ID

**返回值**：
- 1：成功
- 0：失败

### set_window_event_handlers

:::caution 即将移除
该函数计划在 JadeView 0.2.1 版本中移除，请使用 `jade_on` 函数作为替代方案。
:::

```c
int set_window_event_handlers(
    uint32_t window_id,
    WindowEventCallback window_event_cb,
    PageLoadCallback page_load_cb,
    FileDropCallback file_drop_cb
);
```

**功能**：设置全局窗口事件处理器，适用于所有窗口。

**参数**：
- `window_id`：窗口 ID，兼容旧 API，不再使用
- `window_event_cb`：窗口事件回调函数
- `page_load_cb`：页面加载事件回调函数
- `file_drop_cb`：文件拖放事件回调函数

**返回值**：
- 1：成功
- 0：失败

## 3. 窗口属性

### set_window_title

```c
int set_window_title(uint32_t window_id, const char* title);
```

**功能**：设置指定窗口的标题。

**参数**：
- `window_id`：窗口 ID
- `title`：新的窗口标题

**返回值**：
- 1：成功
- 0：失败

### set_window_size

```c
int set_window_size(uint32_t window_id, double width, double height);
```

**功能**：设置指定窗口的大小。

**参数**：
- `window_id`：窗口 ID
- `width`：新的宽度（像素）
- `height`：新的高度（像素）

**返回值**：
- 1：成功
- 0：失败

### set_window_position

```c
int set_window_position(uint32_t window_id, double x, double y);
```

**功能**：设置指定窗口的位置。

**参数**：
- `window_id`：窗口 ID
- `x`：新的 X 坐标（像素，相对于屏幕左上角）
- `y`：新的 Y 坐标（像素，相对于屏幕左上角）

**返回值**：
- 1：成功
- 0：失败

### set_window_visible

```c
int set_window_visible(uint32_t window_id, int visible);
```

**功能**：设置指定窗口的可见性。

**参数**：
- `window_id`：窗口 ID
- `visible`：可见性，0=隐藏，1=显示

**返回值**：
- 1：成功
- 0：失败

### set_window_focus

```c
int set_window_focus(uint32_t window_id);
```

**功能**：将焦点设置到指定窗口。

**参数**：
- `window_id`：窗口 ID

**返回值**：
- 1：成功
- 0：失败

### set_window_enabled

```c
int set_window_enabled(uint32_t window_id, int enabled);
```

**功能**：启用或禁用指定窗口。

**参数**：
- `window_id`：窗口 ID
- `enabled`：启用状态，0=禁用，1=启用

**返回值**：
- 1：成功
- 0：失败

## 4. 窗口状态

### minimize_window

```c
int minimize_window(uint32_t window_id);
```

**功能**：最小化指定窗口。

**参数**：
- `window_id`：窗口 ID

**返回值**：
- 1：成功
- 0：失败

### toggle_maximize_window

```c
int toggle_maximize_window(uint32_t window_id);
```

**功能**：切换指定窗口的最大化/还原状态。

**参数**：
- `window_id`：窗口 ID

**返回值**：
- 1：成功
- 0：失败

**说明**：
- 如果窗口当前是最大化状态，则还原为正常大小
- 如果窗口当前是正常大小，则最大化窗口

### set_window_always_on_top

```c
int set_window_always_on_top(uint32_t window_id, int always_on_top);
```

**功能**：设置指定窗口是否始终置顶。

**参数**：
- `window_id`：窗口 ID
- `always_on_top`：置顶状态，0=取消置顶，1=设置置顶

**返回值**：
- 1：成功
- 0：失败

## 5. WebView 功能

### navigate_to_url

```c
int navigate_to_url(uint32_t window_id, const char* url);
```

**功能**：让指定窗口的 WebView 导航到指定的 URL。

**参数**：
- `window_id`：窗口 ID
- `url`：要导航到的 URL

**返回值**：
- 1：成功
- 0：失败

### execute_javascript

```c
int execute_javascript(uint32_t window_id, const char* script);
```

**功能**：在指定窗口的 WebView 中执行 JavaScript 代码。

**参数**：
- `window_id`：窗口 ID
- `script`：要执行的 JavaScript 代码

**返回值**：
- 0：当前未实现

**说明**：
- 该功能目前尚未实现

### reload

```c
int reload_webview_window(uint32_t window_id);
```

**功能**：重新加载指定窗口的 WebView 内容。

**参数**：
- `window_id`：窗口 ID

**返回值**：
- 1：成功
- 0：失败

**说明**：
- 调用此方法会重新加载当前页面，相当于浏览器的刷新功能
- **支持版本**：0.2 以上

## 6. 事件系统

### jade_on

```c
uint32_t jade_on(const char* event_name, IpcCallback callback);
```

**功能**：注册一个事件处理器，当指定事件触发时，回调函数将被调用。

**参数**：
- `event_name`：事件名称
- `callback`：事件回调函数

**返回值**：
- 返回注册的回调 ID，如果注册失败返回 0

### jade_off

```c
int jade_off(const char* event_name, uint32_t callback_id);
```

**功能**：注销指定事件的指定回调处理器。

**参数**：
- `event_name`：事件名称
- `callback_id`：要注销的回调 ID

**返回值**：
- 1：成功
- 0：失败

### register_ipc_handler

```c
int register_ipc_handler(const char* channel, IpcCallback ipc_cb);
```

**功能**，用于注册 IPC 通道的回调处理器。

**参数**：
- `channel`：IPC 通道名称
- `ipc_cb`：[WindowEventCallback](/guides/reference/data-structures#windoweventcallback)，IPC 回调函数

**返回值**：
- 1：成功
- 0：失败

## 7. 主题与外观

### set_window_theme

```c
int set_window_theme(uint32_t window_id, const char* theme);
```

**功能**：设置指定窗口的主题。

**参数**：
- `window_id`：窗口 ID
- `theme`：主题名称，可选值："Light"、"Dark"、"System"

**返回值**：
- 1：成功
- 0：失败

### get_window_theme

```c
int get_window_theme(uint32_t window_id);
```

**功能**：获取指定窗口的当前主题。

**参数**：
- `window_id`：窗口 ID

**返回值**：
- 0：浅色主题
- 1：深色主题

### set_window_backdrop

```c
int set_window_backdrop(uint32_t window_id, const char* backdrop_type);
```

**功能**：设置指定窗口的背景材料效果。

**参数**：
- `window_id`：窗口 ID
- `backdrop_type`：背景材料类型，可选值："mica"、"micaalt"、"acrylic"

**返回值**：
- 1：成功
- 0：失败

## 8. IPC 通信

### send_ipc_message

```c
int send_ipc_message(uint32_t window_id, const char* message_type, const char* message_content);
```

**功能**：向前端发送 IPC 消息。

**参数**：
- `window_id`：窗口 ID
- `message_type`：消息类型
- `message_content`：消息内容

**返回值**：
- 1：成功
- 0：失败

## 9. 本地服务器

### create_local_server

```c
int create_local_server(const char* root_path, const char* appname, char* url_buffer, size_t buffer_size);
```

**功能**：创建本地服务器，注册自定义协议，用于访问本地文件。

**参数**：
- `root_path`：本地文件根目录路径
- `appname`：应用名称，用于构造自定义协议 URL，NULL 或空字符串表示使用默认名称 "localhost"
- `url_buffer`：输出参数，用于存储构造的自定义协议 URL
- `buffer_size`：url_buffer 的大小

**返回值**：
- 1：成功
- 0：失败

## 10. 清理与工具

### cleanup_all_windows

```c
int cleanup_all_windows();
```

**功能**：清理所有窗口资源并结束事件循环。

**返回值**：
- 1：成功
- 0：失败

### get_window_count

```c
uint32_t get_window_count();
```

**功能**：获取当前已创建的窗口数量。

**返回值**：
- 返回当前已创建的窗口数量

### get_webview_version

```c
int get_webview_version(char* buffer, size_t buffer_size);
```

**功能**：获取 WebView 引擎的版本号，并将其写入指定的缓冲区。

**参数**：
- `buffer`：存储版本号的缓冲区
- `buffer_size`：缓冲区大小

**返回值**：
- 1：成功
- 0：失败
