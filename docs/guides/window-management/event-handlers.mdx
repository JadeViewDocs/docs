---
title: 事件处理
sidebar_position: 3
---

# 事件处理

## set_window_event_handlers

:::caution 即将移除
该函数计划在 JadeView 0.2.1 版本中移除，请使用 `jade_on` 函数作为替代方案。
:::

设置全局窗口事件处理器，适用于所有窗口。

### 函数签名

```c
int set_window_event_handlers(
    uint32_t window_id,
    WindowEventCallback window_event_cb,
    PageLoadCallback page_load_cb,
    FileDropCallback file_drop_cb
);
```

### 参数说明

| 参数 | 类型 | 说明 |
|------|------|------|
| `window_id` | uint32_t | 窗口 ID，兼容旧 API，不再使用 |
| `window_event_cb` | WindowEventCallback | 窗口事件回调函数 |
| `page_load_cb` | PageLoadCallback | 页面加载事件回调函数 |
| `file_drop_cb` | FileDropCallback | 文件拖放事件回调函数 |

### 返回值说明

| 返回值 | 说明 |
|---------|------|
| `1` | 成功 |
| `0` | 失败 |

### 功能描述

设置全局窗口事件处理器，适用于所有窗口。

### 使用示例

```c
// 窗口事件回调函数
int window_event_callback(uint32_t window_id, const char* event_type, const char* event_data) {
    printf("窗口事件：window_id=%u, type=%s, data=%s\n", window_id, event_type, event_data);
    return 0; // 允许操作
}

// 页面加载事件回调函数
void page_load_callback(uint32_t window_id, const char* url, const char* status) {
    printf("页面加载：window_id=%u, url=%s, status=%s\n", window_id, url, status);
}

// 文件拖放事件回调函数
void file_drop_callback(uint32_t window_id, const char* file_path, const char* mime_type, double x, double y) {
    printf("文件拖放：window_id=%u, path=%s, mime=%s, x=%f, y=%f\n", window_id, file_path, mime_type, x, y);
}

// 设置事件处理器
set_window_event_handlers(
    0, // 兼容旧 API，不再使用
    window_event_callback,
    page_load_callback,
    file_drop_callback
);
```

### 回调函数类型

#### WindowEventCallback

```c
typedef int (*WindowEventCallback)(uint32_t window_id, const char* event_type, const char* event_data);
```

**参数说明：**
- `window_id`：窗口 ID
- `event_type`：事件类型
- `event_data`：事件数据

**返回值说明：**
- `0`：允许操作
- `1`：阻止操作

#### PageLoadCallback

```c
typedef void (*PageLoadCallback)(uint32_t window_id, const char* url, const char* status);
```

**参数说明：**
- `window_id`：窗口 ID
- `url`：页面 URL
- `status`：加载状态

#### FileDropCallback

```c
typedef void (*FileDropCallback)(uint32_t window_id, const char* file_path, const char* mime_type, double x, double y);
```

**参数说明：**
- `window_id`：窗口 ID
- `file_path`：文件路径
- `mime_type`：文件 MIME 类型
- `x`：拖放 X 坐标
- `y`：拖放 Y 坐标
