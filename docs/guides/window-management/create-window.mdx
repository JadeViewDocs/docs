---
title: 创建窗口
sidebar_position: 1
---

# 创建窗口

## create_webview_window

创建一个新的 WebView 窗口。

### 函数签名

```c
uint32_t create_webview_window(
    const char* url,
    uint32_t parent_window_id,
    const WebViewWindowOptions* options,
    const WebViewSettings* webview_settings
);
```

### 参数说明

| 参数 | 类型 | 说明 |
|------|------|------|
| `url` | const char* | 初始加载的 URL |
| `parent_window_id` | uint32_t | 父窗口 ID，0 表示无父窗口 |
| `options` | const [WebViewWindowOptions](/guides/reference/data-structures#webview-窗口选项结构体)* | 窗口选项结构体指针，NULL 表示使用默认选项 |
| `webview_settings` | const [WebViewSettings](/guides/reference/data-structures#webview-设置结构体)* | WebView 设置结构体指针，NULL 表示使用默认设置 |

### 返回值说明

返回请求的窗口 ID，如果创建失败返回 0。

### 功能描述

创建一个新的 WebView 窗口。该函数会立即返回请求的窗口 ID，但窗口实际创建是在事件循环线程中异步完成的。

### 使用示例

**重要：窗口必须在 `app-ready` 事件触发后才能创建**，否则会导致创建失败。

```c
#include "jadeview.h"

// app-ready 事件回调函数
// app-ready 事件说明：
// - 触发条件：应用初始化完成
// - 参数1：整数，1表示成功，0表示失败
// - 参数2：字符串，"success"或失败原因文本
int app_ready_callback(int success, const char* reason) {
    // 检查初始化是否成功
    if (success == 1 && reason && strcmp(reason, "success") == 0) {
        // 创建一个简单的 WebView 窗口
        WebViewWindowOptions options = {
            .width = 800,
            .height = 600,
            .resizable = 1,
            .remove_titlebar = 0
        };

        WebViewSettings settings = {
            .autoplay = 0, // 是否允许自动播放媒体，0=禁用，1=启用
            .background_throttling = 0, // 背景限速策略，0=默认（启用背景限速），1=禁用背景限速。在Windows11下，**只有当该功能开启时**，窗口不可见时自动为WebView开启效能模式
                                        // 背景限速是浏览器的性能优化机制，当页面在后台时会降低 JavaScript 执行速度
                                        // 某些场景下（如后台持续运行计算）需要禁用此功能
            .disable_right_click = 0 // 是否禁用右键菜单，0=启用，1=禁用
        };

        uint32_t new_window_id = create_webview_window(
            "https://www.example.com",
            0,
            &options,
            &settings
        );

        if (new_window_id == 0) {
            printf("窗口创建失败\n");
        } else {
            printf("窗口创建成功，窗口 ID：%u\n", new_window_id);
        }
    } else {
        printf("JadeView 初始化失败：%s\n", reason ? reason : "未知错误");
    }
    
    return 0;
}

int main() {
    // 初始化 DLL
    int result = JadeView_init(1, NULL, NULL);
    if (result == 0) {
        printf("DLL 初始化失败\n");
        return 1;
    }
    
    // 注册 app-ready 事件
    jade_on("app-ready", app_ready_callback);
    
    // 运行消息循环
    run_message_loop();
    
    return 0;
}
```

### 注意事项

1. 窗口实际创建是在事件循环线程中异步完成的
2. 函数立即返回请求的窗口 ID
3. 如果创建失败，返回 0
4. 窗口创建完成后会触发 "window-created" 事件
