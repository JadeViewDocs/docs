---
title: 核心 API
sidebar_position: 7
---

# 核心 API

## 初始化与清理

### 初始化 DLL

**函数签名**
```c
int JadeView_init(int enable_devtools, const char* log_path, const char* data_directory);
```

**功能描述**
初始化 JadeView DLL，启动 GUI 线程。

**参数**
- `enable_devtools`：是否启用开发者工具（0=禁用，1=启用）
- `log_path`：日志文件路径，NULL 表示不输出日志到文件
- `data_directory`：WebView 数据目录，NULL 表示使用默认值

**返回值**
- 1：初始化成功
- 0：初始化失败

**说明**
- 此函数会启动一个新的 GUI 线程，所有窗口操作都在该线程中执行
- 初始化完成后会发送 "app-ready" 事件

### 清理所有窗口

**函数签名**
```c
int cleanup_all_windows();
```

**功能描述**
清理所有窗口资源并结束事件循环。

**返回值**
- 1：成功
- 0：失败

## 消息循环

### 运行消息循环

**函数签名**
```c
int run_message_loop();
```

**功能描述**
运行消息循环，阻塞等待应用程序退出。

**返回值**
- 1：消息循环正常退出

**说明**
- 在 DLL 模式下，此函数通常不需要宿主调用，因为已在 `JadeView_init` 中创建了 GUI 线程
- 此函数用于阻塞等待，直到 `cleanup_all_windows` 被调用

## 工具函数

### 获取窗口数量

**函数签名**
```c
uint32_t get_window_count();
```

**功能描述**
获取当前已创建的窗口数量。

**返回值**
- 返回当前已创建的窗口数量

### 获取 WebView 版本

**函数签名**
```c
int get_webview_version(char* buffer, size_t buffer_size);
```

**功能描述**
获取 WebView 引擎的版本号，并将其写入指定的缓冲区。

**参数**
- `buffer`：存储版本号的缓冲区
- `buffer_size`：缓冲区大小

**返回值**
- 1：成功
- 0：失败

### 创建安全的文本指针

**函数签名**
```c
extern "system" c_char* jade_text_create(const c_char* text);
```

**功能描述**
创建安全的文本指针，用于在 Rust 和 C 之间安全传递字符串，特别适合前端使用 invoke 通讯时后端返回文本数据。

**参数**
- `text`：要创建的文本内容，UTF-8 编码

**返回值**
- 返回创建的安全文本指针，失败返回 NULL

**说明**
- 适合任何需要在 Rust 和 C 之间频繁传递字符串的场景
- 创建的文本指针需要使用 `jade_text_free` 释放，避免内存泄漏
- 1.0.5 版本新增

### 释放文本内存

**函数签名**
```c
extern "system" void jade_text_free(c_char* ptr);
```

**功能描述**
释放由 `jade_text_create` 创建的文本内存。

**参数**
- `ptr`：由 `jade_text_create` 创建的文本指针

**返回值**
- 无

**说明**
- 必须使用此函数释放由 `jade_text_create` 创建的文本指针
- 避免直接使用 `free` 函数释放，否则可能导致内存错误
- 1.0.5 版本新增
